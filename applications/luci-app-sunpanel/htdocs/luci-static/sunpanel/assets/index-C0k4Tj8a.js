import{bG as w,j as _,bH as q,r as g,bj as e,c as W,w as j,b2 as M,b6 as H,b7 as p,bb as F,bc as r,ba as n,af as R,b8 as T,b9 as D,br as O,bv as G,bo as J,bx as K,a as Q,H as X,b3 as Y,bS as Z,k as b}from "./index-Cr6VSFOe.js";import{_ as ee}from "./index.vue_vue_type_script_setup_true_lang-GZDTfTwy.js";import{g as te,b as C,N as L,d as ae,a as P}from "./index-B9C2E4-e.js";import{S as se}from "./index-DEZ9xjST.js";import{f as le,C as A,F as ne}from "./index-BfqqEllV.js";import{N as oe}from "./Alert-BHC7xqF2.js";import{N as re}from "./DataTable-tOEfF-kV.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";function ie(u){let d="/panel/users/create";return u.id&&(d="/panel/users/update"),w({url:d,data:u})}function ue(u){return w({url:"/panel/users/getList",data:u})}function de(u){return w({url:"/panel/users/deletes",data:{userIds:u}})}function me(){return w({url:"/panel/users/getPublicVisitUser"})}function B(u){return w({url:"/panel/users/setPublicVisitUser",data:{userId:u}})}const ce={class:"float-right"},pe=_({__name:"index",props:{visible:{type:Boolean},userId:null,userInfo:null},emits:["update:visible","done"],setup(u, {emit:d}){const S=u,x=q(),h={name:"",username:"",role:2,status:3},o=g(h),$=g(null),k=g([{label:e("common.role.regularUser"),value:2},{label:e("common.role.admin"),value:1}]),z={username:[{required:!0,trigger:"blur",message:e("adminSettingUsers.formRules.usernameRequired"),min:5}],role:{required:!0,trigger:"blur",type:"number",message:e("adminSettingUsers.formRules.roleRequired")},password:{trigger:"blur",min:6,max:20,message:e("adminSettingUsers.formRules.passwordLimit")}},m=W({get:()=>S.visible,set: t=>{d("update:visible",t)}});j(m,(t, a)=>{var f;(f=S.userInfo)!=null&&f.id?o.value=S.userInfo||{}:o.value=h});const I=async()=>{const t=await ie(o.value);t.code===0?d("done",t.data.id):t.code!==-1&&x.warning(e("common.failed"))},U= t=>{var a;t.preventDefault(),(a=$.value)==null||a.validate(f=>{f?console.log(f):I()})};return(t, a)=>{var f;return M(),H(n(ee),{show:n(m),"onUpdate:show":a[4]||(a[4]= c=>O(m)?m.value=c:null),size:"small",preset:"card",style:{width:"400px"},title:`${(f=u.userInfo)!=null&&f.id?t.$t("common.edit"):t.$t("common.add")}`},{footer:p(()=>[F("div",ce,[r(n(R),{type:"success",size:"small",onClick:U},{default:p(()=>[T(D(t.$t("common.save")),1)]),_:1})])]),default:p(()=>[r(n(te),{ref_key:"formRef",ref:$,model:o.value,rules:z},{default:p(()=>[r(n(C),{path:"username",label:t.$t("common.username")},{default:p(()=>[r(n(L),{value:o.value.username,"onUpdate:value":a[0]||(a[0]= c=>o.value.username=c),type:"text",placeholder:t.$t("common.inputPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),r(n(C),{path:"name",label:t.$t("common.nikeName")},{default:p(()=>[r(n(L),{value:o.value.name,"onUpdate:value":a[1]||(a[1]= c=>o.value.name=c),type:"text",placeholder:t.$t("common.inputPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),r(n(C),{path:"role",label:t.$t("adminSettingUsers.role")},{default:p(()=>[r(n(ae),{value:o.value.role,"onUpdate:value":a[2]||(a[2]= c=>o.value.role=c),options:k.value},null,8,["value","options"])]),_:1},8,["label"]),r(n(C),{path:"password",label:t.$t("common.password")},{default:p(()=>{var c;return[r(n(L),{value:o.value.password,"onUpdate:value":a[3]||(a[3]= V=>o.value.password=V),maxlength:20,type:"password",placeholder:`${(c=u.userInfo)!=null&&c.id?t.$t("adminSettingUsers.EditpasswordPlaceholder"):t.$t("adminSettingUsers.passwordPlaceholder")}`},null,8,["value","placeholder"])]}),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),fe={class:"h-full overflow-auto p-2"},ge={class:"my-[10px] flex items-center"},we=_({__name:"index",setup(u){const d=q(),S=G(),x=J(),h=g(!1),o=g(!1),$=g(),k=g(),z=K(),m=g(null),I=({update:l})=>[{title:e("common.username"),key:"username",render(s){var N;const i=[s.username];return s.username===((N=S.userInfo)==null?void 0:N.username)&&i.push(b(P,{type:"success",size:"small",style:{marginLeft:"5px"},bordered:!1},e("adminSettingUsers.currentUseUsername"))),m.value&&m.value===s.id&&i.push(b(P,{type:"error",size:"small",style:{marginLeft:"5px"}},e("adminSettingUsers.pblicText"))),i}},{title:e("common.nikeName"),key:"name"},{title:e("adminSettingUsers.role"),key:"role",render(s){switch(s.role){case A.admin:return b(P,{type:"info"},e("common.role.admin"));case A.regularUser:return b(P,e("common.role.regularUser"));default:return"-"}}},{title:e("common.action"),key:"",render(s){const i=b(R,{strong:!0,tertiary:!0,size:"small"},{default(){return b(se,{icon:"mingcute:more-1-fill"})}});return b(ne,{trigger:"click",onSelect(N){switch(N){case"update":l(s);break;case"publicMode":m.value&&m.value===s.id?B(null).then(({code:v})=>{v===0&&(m.value=null)}).catch(v=>{d.error(`${e("common.failed")}:${v.msg}`)}):B(s.id).then(({code:v})=>{v===0&&(m.value=s.id)}).catch(v=>{d.error(`${e("common.failed")}:${v.msg}`)});break;case"delete":z.warning({title:e("common.warning"),content:e("adminSettingUsers.deletePromptContent",{name:s.name,username:s.username}),positiveText:e("common.confirm"),negativeText:e("common.cancel"),onPositiveClick:()=>{E([s.id])}});break}},options:[{label:e("common.edit"),key:"update"},{label:e("adminSettingUsers.setOrUnsetPublicMode"),key:"publicMode"},{label:e("common.delete"),key:"delete"}]},{default:()=>i})}}],U=g(),t=I({update(l){k.value=l,o.value=!0}}),a=Q({page:1,showSizePicker:!0,pageSizes:[10,30,50,100,200],pageSize:10,itemCount:0,onChange: l=>{a.page=l,y(null)},onUpdatePageSize: l=>{a.pageSize=l,a.page=1,y(null)},prefix(l){return e("adminSettingUsers.userCountText",{count:l.itemCount})}});function f(l){y(l)}function c(){if(x.isExpired&&U.value&&U.value.length>=2){d.warning(e("adminSettingUsers.noProCreateLimitWarning"));return}o.value=!0,k.value={}}function V(){o.value=!1,d.success(e("common.success")),y(null)}async function y(l){h.value=!0;const s={page:l||a.page,limit:a.pageSize};$.value!==""&&(s.keyWord=$.value);try{const{data:i}=await ue(s);a.itemCount=i.count,i.list&&(U.value=i.list),h.value=!1}catch(i){console.error(i)}}async function E(l){try{await de(l),d.success(e("common.deleteSuccess")),y(null)}catch(s){const i=s;d.error(`${e("common.deleteFail")}:${i.msg}`)}}return X(()=>{me().then(({data:l})=>{m.value=l.id||null}),y(null)}),(l, s)=>(M(),Y("div",fe,[r(n(Z),{style:{"border-radius":"10px"},size:"small"},{default:p(()=>[r(n(oe),{type:"info",bordered:!1},{default:p(()=>[T(D(l.$t("adminSettingUsers.alertText")),1)]),_:1}),F("div",ge,[r(n(R),{type:"primary",size:"small",onClick:c},{default:p(()=>[T(D(l.$t("common.add")),1)]),_:1}),r(n(le),{class:"mx-2","show-icon":"",content:n(e)("adminSettingUsers.addUserNoProText")},null,8,["content"])]),r(n(re),{columns:n(t),data:U.value,pagination:a,bordered:!1,loading:h.value,remote:!0,"onUpdate:page":f},null,8,["columns","data","pagination","loading"])]),_:1}),r(pe,{visible:o.value,"onUpdate:visible":s[0]||(s[0]= i=>o.value=i),"user-info":k.value,onDone:V},null,8,["visible","user-info"])]))}});export{we as default};
