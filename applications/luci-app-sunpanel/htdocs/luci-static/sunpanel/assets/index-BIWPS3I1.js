import{E as B,S as Y}from "./index-DEZ9xjST.js";import{_ as A}from "./index.vue_vue_type_script_setup_true_lang-GZDTfTwy.js";import{d4 as te,j as re,bH as ne,r as d,H as se,b2 as v,b3 as _,bc as s,b7 as a,bb as h,b9 as g,ba as r,af as $,b8 as I,bd as C,as as ae,bz as le,b6 as P,bj as p}from "./index-Cr6VSFOe.js";import{g as ie}from "./about-don0uSCL.js";import{k as ue,c as G,m as V,n as H,b as j,o as ce,p as pe,q as de,r as fe}from "./index-BfqqEllV.js";import{N as z}from "./Alert-BHC7xqF2.js";import{N as me}from "./index-B9C2E4-e.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const L=1,ve=1,ge="Sun-Panel-Config";class F extends Error{constructor(o){super(o),this.name="FormatError"}}class W extends Error{constructor(o){super(o),this.name="ConfigVersionLowError"}}function he(u){const o={version:L,appName:ge,exportTime:B().format("YYYY-MM-DD HH:mm:ss"),appVersion:u||"",md5:""};function n(){o.md5=q(JSON.stringify(o))}return{addIconsData(i){return o.icons=i,this},exportFile(){n();const i=JSON.stringify(o);if(i){const f=new Blob([i],{type:"application/json"}),y=document.createElement("a");y.href=URL.createObjectURL(f),y.download=`SunPanel-Data${B().format("YYYYMMDDHHmm")}.sun-panel.json`,y.click()}},string(){return n(),JSON.stringify(o)}}}function ye(u){let o;try{o=JSON.parse(u)}catch{throw new F("file format error")}const n=xe(o),i=q(u);if(!n)throw new F("file format error");if(o.version<ve)throw new W("");return{isPassCheckMd5:()=>i===n.md5,isPassCheckConfigVersionOld:()=>!(n.version<L),isPassCheckConfigVersionNew:()=>!(n.version>L),isPassCheckConfigVersionBest:()=>n.version===L,jsonStruct:n,hasProperty: f=>f in n,geticons:()=>n.icons||[]}}function xe(u){const o=["version","appName","exportTime","appVersion","md5"];for(const i of o)if(!(i in u))return null;return u}function q(u){try{const o=JSON.parse(u);be(o);const n=JSON.stringify(o);return te.MD5(n).toString()}catch{return""}}function be(u){for(const o in u)if(o==="md5"){delete u[o];return}}const we={class:"p-2"},ke={class:"flex justify-center m-[50px]"},Ie={class:"m-[10px]"},Ce={class:"m-[10px]"},Se={class:"flex justify-center"},Ne={href:"https://hslr-s.github.io/sun-panel-tool-page/#/",target:"_blank"},_e={key:0},$e={key:0},Me=h("h2",null,"JSON 数据",-1),De={key:0},Ee={class:"mt-[50px]"},Pe={class:"mt-[50px]"},Re=re({__name:"index",setup(u){const o=ne(),n=d(null),i=d([]),f=d(!1),y=d(!1),S=d(!1),O=d(!1),U=d(""),K=d(!1),N=d(null),M=d(["icons"]),k=d(["icons"]);async function Q(){var l,x;const e=(l=N.value)==null?void 0:l.geticons(),t=50;if(!e)return null;try{for(let b=0; b<e.length; b++){const w=e[b],c=await ce({title:w.title,sort:w.sort,cardStyle:w.cardStyle});if(c.code===0){const T=(x=c.data)==null?void 0:x.id;if(T){let D=[];for(let E=0; E<w.children.length; E++){const m=w.children[E];if(D.push({title:m.title,sort:m.sort,icon:m.icon,url:m.url,lanUrl:m.lanUrl,description:m.description,openMethod:m.openMethod,itemIconGroupId:T,cardType:m.cardType,backgroundColor:m.backgroundColor,expandParam:m.expandParam}),D.length===t||E===w.children.length-1){const R=await pe(D);if(R.code!==0)return R.msg;D=[]}}}}else return c.msg}return null}catch(b){return b instanceof Error?`${p("common.failed")}: ${b.message}`:p("common.unknownError")}}async function X(){const e=[],{code:t,data:l}=await de();return t===0?(await Promise.all(l.list.map(async x=>{const b={title:x.title,sort:x.sort,children:[],cardStyle:x.cardStyle},w=await fe(x.id);if(w.code===0)for(const c of w.data.list)b.children.push({icon:c.icon,sort:c.sort||99999,title:c.title,url:c.url,lanUrl:c.lanUrl||"",description:c.description||"",openMethod:c.openMethod||1,cardType:c.cardType,backgroundColor:c.backgroundColor,expandParam:c.expandParam});e.push(b)})),e):[]}se(()=>{ie().then(e=>{e.code===0&&(U.value=e.data.versionName)})});function Z(e){if(O.value=!0,console.log(e.file.file),e.file.file){const t=new FileReader;t.onload=()=>{t.result?(n.value=t.result,J()):o.error(`${p("common.failed")}: ${p("common.repeatLater")}`),O.value=!1},t.readAsText(e.file.file)}}function J(){if(i.value=[],n.value)try{N.value=ye(n.value),N.value&&(N.value.isPassCheckMd5()||i.value.push(p("apps.exportImport.fileModified")),N.value.isPassCheckConfigVersionOld()||i.value.push(p("apps.exportImport.warnConfigFileLow")),N.value.isPassCheckConfigVersionNew()||i.value.push(p("apps.exportImport.softwareVersionLow")),f.value=!f.value)}catch(e){e instanceof W?(o.error(p("apps.exportImport.errorConfigFileLow")),console.error("The configuration file version is too low to be compatible")):e instanceof F&&(o.error(p("apps.exportImport.errorConfigFileFormat")),console.error("The format is incorrect and cannot be imported"))}else o.error(p("apps.exportImport.errorConfigFileFormat"))}async function ee(){S.value=!0;const e=he(U.value);if(k.value.includes("icons")){console.log("export icons ...");const t=await X();e.addIconsData(t),console.log("export icons finish",t)}n.value=e.string(),e.exportFile(),S.value=!1,y.value=!1}async function oe(){if(S.value=!0,k.value.includes("icons")){console.log("export icons ...");const e=await Q();e!==null&&o.success(`${p("common.failed")}:${e}`)}S.value=!1,f.value=!1,o.success(`${p("common.success")}, ${p("common.refreshPage")}`)}return(e, t)=>(v(),_("div",we,[s(r(z),{type:"info",bordered:!1},{default:a(()=>[h("p",null,g(e.$t("apps.exportImport.tip")),1)]),_:1}),h("div",ke,[h("div",Ie,[s(r(ue),{accept:".sun-panel.json,.sunpanel.json","directory-dnd":"","default-upload":!1,"show-file-list":!1,onChange:Z},{default:a(()=>[s(r($),{type:"info",size:"large",loading:O.value},{icon:a(()=>[s(r(Y),{icon:"fa6:solid-file-import"})]),default:a(()=>[I(" "+g(e.$t("apps.exportImport.import")),1)]),_:1},8,["loading"])]),_:1})]),h("div",Ce,[s(r($),{type:"info",size:"large",onClick:t[0]||(t[0]= l=>y.value=!y.value)},{icon:a(()=>[s(r(Y),{icon:"fa6:solid-file-export"})]),default:a(()=>[I(" "+g(e.$t("apps.exportImport.export")),1)]),_:1})])]),h("div",Se,[h("a",Ne,g(e.$t("apps.exportImport.transmuteStandard")),1)]),K.value?(v(),_("div",_e,[s(r($),{onClick:J},{default:a(()=>[I(" 检查导入 ")]),_:1}),s(r($),{onClick:t[1]||(t[1]= l=>n.value="")},{default:a(()=>[I(" 清空导入数据 ")]),_:1}),s(r(me),{value:n.value,"onUpdate:value":t[2]||(t[2]= l=>n.value=l),type:"textarea",placeholder:"基本的 Textarea"},null,8,["value"]),n.value?(v(),_("div",$e,[Me,h("pre",null,g(n.value),1)])):C("",!0)])):C("",!0),s(r(A),{show:f.value,"onUpdate:show":t[4]||(t[4]= l=>f.value=l),style:{"max-width":"400px"},title:e.$t("apps.exportImport.import")},{default:a(()=>[i.value.length>0?(v(),_("div",De,[s(r(z),{title:e.$t("common.warning"),type:"warning"},{default:a(()=>[(v(!0),_(ae,null,le(i.value,(l, x)=>(v(),_("div",{key:x},g(l),1))),128))]),_:1},8,["title"])])):C("",!0),s(r(G),{"title-placement":"left"},{default:a(()=>[I(g(e.$t("apps.exportImport.selectImportData")),1)]),_:1}),s(r(V),{justify:"center",style:{"margin-top":"20px"}},{default:a(()=>[s(r(H),{value:k.value,"onUpdate:value":t[3]||(t[3]= l=>k.value=l)},{default:a(()=>[M.value.includes("icons")?(v(),P(r(j),{key:0,value:"icons",label:e.$t("apps.exportImport.moduleIcon")},null,8,["label"])):C("",!0),M.value.includes("style")?(v(),P(r(j),{key:1,value:"style",label:e.$t("apps.exportImport.moduleStyle")},null,8,["label"])):C("",!0)]),_:1},8,["value"])]),_:1}),s(r(V),{justify:"center"},{default:a(()=>[h("div",Ee,[s(r($),{type:"success",disabled:k.value.length===0,loading:S.value,onClick:oe},{default:a(()=>[I(g(e.$t("common.continue")),1)]),_:1},8,["disabled","loading"])])]),_:1})]),_:1},8,["show","title"]),s(r(A),{show:y.value,"onUpdate:show":t[6]||(t[6]= l=>y.value=l),style:{"max-width":"400px"},title:e.$t("apps.exportImport.export")},{default:a(()=>[s(r(G),{"title-placement":"left"},{default:a(()=>[I(g(e.$t("apps.exportImport.selectExportData")),1)]),_:1}),s(r(V),{justify:"center",style:{"margin-top":"20px"}},{default:a(()=>[s(r(H),{value:k.value,"onUpdate:value":t[5]||(t[5]= l=>k.value=l)},{default:a(()=>[M.value.includes("icons")?(v(),P(r(j),{key:0,value:"icons",label:e.$t("apps.exportImport.moduleIcon")},null,8,["label"])):C("",!0),M.value.includes("style")?(v(),P(r(j),{key:1,value:"style",label:e.$t("apps.exportImport.moduleStyle")},null,8,["label"])):C("",!0)]),_:1},8,["value"])]),_:1}),s(r(V),{justify:"center"},{default:a(()=>[h("div",Pe,[s(r($),{type:"success",disabled:k.value.length===0,loading:S.value,onClick:ee},{default:a(()=>[I(g(e.$t("common.continue")),1)]),_:1},8,["disabled","loading"])])]),_:1})]),_:1},8,["show","title"])]))}});export{Re as default};
