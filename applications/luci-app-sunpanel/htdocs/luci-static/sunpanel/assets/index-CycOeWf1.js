import{bP as q,r as u,bj as r,j as P,b2 as y,b6 as H,b7 as L,bb as x,b9 as S,ba as a,bH as G,c as T,bC as F,b3 as $,bc as b,br as E,H as K,W as J,bE as Q,b8 as R,bd as U,k as p,bL as X,bK as Y,bM as Z,bS as ee}from "./index-Cr6VSFOe.js";import{g as te,D as s,d as ae,e as ne,a as se,E as re,f as oe,h as ie}from "./index-BfqqEllV.js";import{a as z}from "./index.vue_vue_type_script_setup_true_lang-GZDTfTwy.js";import{e as D,a as A}from "./index-B9C2E4-e.js";import{S as le}from "./index-DEZ9xjST.js";import{N as ce}from "./DataTable-tOEfF-kV.js";import{N as B}from "./Alert-BHC7xqF2.js";import{_ as O}from "./_plugin-vue_export-helper-DlAUqK2U.js";const I=q("docker-store",()=>{const h=u([]),f=u("container"),k=u(!1),i=u([]),_=u({}),d=u("");async function w(){i.value=[],await te().then(l=>{h.value=l.data.list;for(let n=0; n<l.data.list.length; n++){const v=l.data.list[n];_.value[v.id]={},v.state===s.running&&i.value.push(v.id)}d.value="",c()}).catch(l=>{d.value=`${r("apps.dockerManage.dockerError")}: ${l.msg}`})}async function c(){await ae(i.value).then(l=>{_.value=l.data}).catch(l=>{})}return{actionMenuBar:f,refreshContainerList:w,containerRuningStats:_,refreshContainerListStats:c,containerList:h,isLoading:k,refreshContainerListErrorMsg:d}}),ue={class:"text-xs text-slate-400"},de=P({__name:"RowName",props:{value:null},setup(h){return(f, k)=>(y(),H(a(z),{"line-clamp":2},{default:L(()=>[x("div",null,S(h.value.name),1),x("div",ue,S(h.value.image),1)]),_:1}))}}),pe={class:"w-full"},me={key:0},fe={key:1},ve=P({__name:"RowAction",props:{value:null},setup(h){const f=h,k=I(),i=u(f.value),_=G(),d=u(!1),w=T(()=>{switch(i.value.state){case s.created:case s.running:case s.paused:case s.dead:case s.exited:return!0;case s.restarting:case s.removing:return!0;default:return!1}}),c=T({get(){return f.value.state===s.running},set(){d.value=!0;const l=!c.value;ne({id:i.value.id,action:l}).then(({code:n,msg:v})=>{n!==0?_.warning(v):i.value.state=l?s.running:s.exited,d.value=!1,k.refreshContainerList()}).catch(n=>{if(d.value=!1,n.code===-1){_.error(`${r("common.failed")}:${n.msg}`,{duration:5e3,closable:!0,keepAliveOnHover:!0});return}F(n)})}});return(l, n)=>(y(),$("div",pe,[a(w)?(y(),$("div",me,[b(a(D),{value:a(c),"onUpdate:value":n[0]||(n[0]= v=>E(c)?c.value=v:null),loading:d.value},null,8,["value","loading"])])):(y(),$("div",fe,[b(a(D),{value:a(c),"onUpdate:value":n[1]||(n[1]= v=>E(c)?c.value=v:null),loading:d.value,disabled:""},null,8,["value","loading"])]))]))}}),ge={class:"h-full overflow-auto"},he={class:"flex flex-col h-full gap-2"},ke=["href"],_e={class:"h-full flex"},ye=P({__name:"index",setup(h){const f=u(!1);let k;const i=I(),_=se(),d=u(null),w=u(0),c=u(null),l=u(null),n=u(!1),v=({sendMail:m})=>[{title:r("apps.dockerManage.containerName"),key:"name",minWidth:300,sorter:"default",render(t){return p(de,{value:t})}},{title:r("apps.dockerManage.state"),align:"center",key:"state",width:100,sorter:"default",render(t){const e={type:void 0,name:r("apps.dockerManage.unknown")};switch(t.state){case s.created:e.name=r("apps.dockerManage.created"),e.type="info";break;case s.restarting:e.name=r("apps.dockerManage.restarting"),e.type="warning";break;case s.removing:e.name=r("apps.dockerManage.removing"),e.type="warning";break;case s.paused:e.name=r("apps.dockerManage.paused"),e.type="warning";break;case s.exited:e.name=r("apps.dockerManage.exited");break;case s.dead:e.name=r("apps.dockerManage.dead"),e.type="error";break;case s.running:e.name=r("apps.dockerManage.running"),e.type="success";break}return p(A,{type:e.type,bordered:!1,round:!0,size:"small",title:t.status},{default:()=>e.name})}},{title:r("apps.dockerManage.resourceOverview"),key:"resource",width:200,render(t){const e=i.containerRuningStats[t.id];let g="",o="";return t.status===s.running&&(g="CPU: --",o="RAM: --"),e&&((e.cpuPercent||e.cpuPercent===0)&&(e.cpuPercent=N(e.cpuPercent||0),g=`CPU: ${e.cpuPercent}%`),(e.memory||e.memory===0)&&(e.memory=N(e.memory||0),o=`RAM: ${e.memory}MB`)),p("div",[p("div",{class:"text-xs"},g),p("div",{class:"text-xs"},o)])}},{title:r("apps.dockerManage.ports"),key:"port",width:200,render(t){const e= o=>p(A,{size:"tiny",style:{margin:"0 2px"},type:"info",title:`(${o.type}) ${o.ip}:${o.publicPort} => ${o.privatePort}`},`${o.type} ${o.ip}:${o.publicPort}`),g=[];for(const o in t.ports)if(Object.prototype.hasOwnProperty.call(t.ports,o)){const C=t.ports[o];C.publicPort!==0&&C.privatePort!==0&&g.push(e(C))}return p(z,{lineClamp:2},g)}},{title(){return[p("span",r("apps.dockerManage.action")),p("span",{style:"max-width:80px"},p(oe,{style:"margin-left:8px"}))]},key:"action",fixed:"right",width:100,align:"center",render(t){return p(ve,{value:t})}},{key:"add",fixed:"right",width:50,align:"center",render(t){return p("div",{title:r("common.addCardToGroup"),style:{display:"flex",justifyContent:"center"},onClick:()=>j(t)},p(le,{class:"add-card",style:{width:"20px",height:"20px",cursor:"pointer"},icon:"fluent--square-add-16-regular"}))}}];function N(m){return Number(m.toFixed(2))}const V=v({sendMail(m){}});K(async()=>{M(),window.addEventListener("resize",M),f.value=!0,await i.refreshContainerList(),f.value=!1,k=setInterval(()=>{i.refreshContainerListStats()},5e3)});function M(){J(()=>{var m,t;if(d.value&&c.value){const e=((m=d.value)==null?void 0:m.$el)||d.value,g=((t=c.value)==null?void 0:t.$el)||c.value,o=e?e.offsetHeight:0,C=g?g==null?void 0:g.offsetHeight:0;w.value=o-60-C}})}function j(m){l.value={title:m.name,icon:{text:m.name,itemType:X.url},cardType:Y.Docker,openMethod:Z.newTab,url:"",expandParam:{containerId:m.id,containerName:m.name}},n.value=!0}function W(){n.value=!1,ie().triggerUpdate()}return Q(()=>{clearInterval(k),window.removeEventListener("resize",M)}),(m, t)=>(y(),$("div",ge,[x("div",he,[x("div",null,[b(a(B),{type:"info",closable:"",onAfterLeave:M},{default:L(()=>[R(S(a(r)("apps.dockerManage.alertText")),1)]),_:1}),a(i).refreshContainerListErrorMsg?(y(),H(a(B),{key:0,class:"mt-2",type:"error",closable:"",onAfterLeave:M},{default:L(()=>[R(S(a(i).refreshContainerListErrorMsg)+" ",1),x("a",{target:"_blank",class:"text-lime-600",href:a(_).faqLinkWithLang("docker_run_error")}," ["+S(a(r)("common.viewSolution"))+"] ",9,ke)]),_:1})):U("",!0)]),x("div",_e,[b(a(ce),{"flex-height":"",bordered:!1,size:"small",data:a(i).containerList,columns:a(V),loading:f.value,"scroll-x":800},null,8,["data","columns","loading"])])]),b(a(re),{visible:n.value,"onUpdate:visible":t[0]||(t[0]= e=>n.value=e),"item-info":l.value,"is-out-add":"",onDone:W},null,8,["visible","item-info"])]))}}),be=O(ye,[["__scopeId","data-v-d846ed3e"]]),xe={key:0,class:"h-full overflow-auto p-2"},we=P({__name:"index",setup(h){const f=I();return(k, i)=>a(f).actionMenuBar==="container"?(y(),$("div",xe,[b(a(ee),{style:{"border-radius":"10px",height:"100%"},size:"small","content-style":"height: 100%"},{default:L(()=>[b(a(be))]),_:1})])):U("",!0)}}),Te=O(we,[["__scopeId","data-v-2a110036"]]);export{Te as default};
